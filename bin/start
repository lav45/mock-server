#!/usr/bin/env php
<?php declare(strict_types=1);

require __DIR__ . '/../vendor/autoload.php';

use Lav45\MockServer\Config;
use Lav45\MockServer\LoggerFactory;
use Lav45\MockServer\Server;

$config = new Config()
    ->port(getenv('PORT'))
    ->mocks(getenv('MOCKS_PATH'))
    ->locale(getenv('LOCALE'))
    ->log(getenv('LOG_LEVEL'))
    ->fileWatch(getenv('FILE_WATCH_TIMEOUT'));

$logger = LoggerFactory::create('mock-server', $config->getLogLevel());

$mockServer = new Server($config, $logger)->start();

const SIGINT = 2;
const SIGTERM = 15;

$logger->info(\sprintf("Received signal %d, stopping HTTP server", Amp\trapSignal([SIGINT, SIGTERM])));
$mockServer->stop();